language: python
python:
  - "3.3"
  - "3.4"
  - "3.5"
  - "3.5-dev"
  - "3.6"
  - "3.6-dev"
  - "3.7-dev"
install:
  - pip install -r requirements_dev.txt
script:
  - pytest src/test_*.py --cov=geohash
  - pycodestyle src/*py --ignore=E501
  - aws cloudformation validate-template --template-body file://cf.yaml
after_success:
  - coveralls
before_deploy: aws cloudformation package --template-file cf.yaml --s3-bucket cf-templates-ohq9r4yozcyg-us-east-1 --output-template-file out.yaml
deploy:
  provider: script
  script: aws cloudformation deploy --template-file out.yaml --stack-name enkel-api --capabilities CAPABILITY_IAM
  skip_cleanup: true
  on:
    python: "3.6"
